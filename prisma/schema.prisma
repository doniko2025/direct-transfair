// ==========================================================
//  PRISMA SCHEMA â€” DIRECT TRANSF'AIR
//  Multi-tenant (Client), Users, Beneficiaries, Transactions
//  + FULL PAYMENT SYSTEM (Wallet / OM / Sendwave / Card Ready)
// ==========================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================================
// ENUMS
// ==========================================================

enum TransactionStatus {
  PENDING
  VALIDATED
  PAID
  CANCELLED
}

enum PayoutMethod {
  CASH_PICKUP
  BANK_DEPOSIT
  MOBILE_MONEY
  WALLET
}

enum PaymentMethod {
  WALLET         // Paiement Wallet interne Direct Transf'air
  ORANGE_MONEY   // Paiement mobile via API Orange Money
  SENDWAVE       // L'utilisateur paie dans l'app Sendwave et fournit un code
  CARD           // Paiement par carte (Stripe / Flutterwave â†’ Ã  venir)
}

enum PaymentProvider {
  DIRECT
  ORANGE_MONEY
  SENDWAVE
}

enum ProviderStatus {
  PENDING
  SUCCESS
  FAILED
}

// ==========================================================
// MODEL: CLIENT (tenant)
// ==========================================================

model Client {
  id        Int      @id @default(autoincrement())
  code      String   @unique       // ex: DONIKO
  name      String                // ex: Doniko SARL
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // For future Phase B â€” multi-database per tenant
  dbName   String?
  dbHost   String?
  dbPort   Int?
  dbUser   String?
  dbSchema String?

  // Relations
  users         User[]
  beneficiaries Beneficiary[]
  transactions  Transaction[]
}

// ==========================================================
// MODEL: USER
// ==========================================================

model User {
  id       String @id @default(cuid())
  email    String @unique
  password String

  role String @default("USER") // USER | ADMIN

  // Infos identitÃ© (KYC light)
  firstName String?
  lastName  String?
  phone     String?

  // Adresse physique
  addressNumber String?
  addressStreet String?
  postalCode    String?
  city          String?
  country       String?

  // Infos personnelles
  nationality String?
  birthDate   String?
  birthPlace  String?

  // ðŸ”— Tenant
  clientId Int
  client   Client @relation(fields: [clientId], references: [id], onDelete: Restrict)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  transactions  Transaction[]
  beneficiaries Beneficiary[]
}

// ==========================================================
// MODEL: BENEFICIARY
// ==========================================================

model Beneficiary {
  id       String  @id @default(cuid())
  fullName String
  country  String
  city     String
  phone    String?

  userId String
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // ðŸ”— Tenant
  clientId Int
  client   Client @relation(fields: [clientId], references: [id], onDelete: Restrict)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  transactions Transaction[]
}

// ==========================================================
// MODEL: TRANSACTION (amÃ©liorÃ© pour paiements externes)
// ==========================================================

model Transaction {
  id        String  @id @default(cuid())
  reference String  @unique

  amount Decimal @db.Decimal(12, 2)
  fees   Decimal @db.Decimal(12, 2)
  total  Decimal @db.Decimal(12, 2)

  currency String // EUR / XOF / USD

  status       TransactionStatus @default(PENDING)
  payoutMethod PayoutMethod      @default(CASH_PICKUP)

  // ==========================================
  // ðŸ”¥ SECTION PAIEMENT (NOUVEAUTÃ‰ MAJEURE)
  // ==========================================

  paymentMethod PaymentMethod @default(WALLET)

  provider       PaymentProvider?
  providerRef    String?
  providerStatus ProviderStatus? @default(PENDING)

  // ==========================================

  senderId String
  sender   User @relation(fields: [senderId], references: [id])

  beneficiaryId String
  beneficiary   Beneficiary @relation(fields: [beneficiaryId], references: [id])

  clientId Int
  client   Client @relation(fields: [clientId], references: [id], onDelete: Restrict)

  paidAt      DateTime?
  cancelledAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
